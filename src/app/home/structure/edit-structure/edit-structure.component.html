<div class="modal-header" data-bs-theme="ligth">
  <h1 class="modal-title fs-5">Modifier structure</h1>
  <button type="button" class="btn-close" aria-label="Close" (click)="activeModal.close()"></button>
</div>

<div class="modal-body">
  <form [formGroup]="reactiveForm_edit_structure"
        (ngSubmit)="onSubmit_edit_structure()"
        #form_edit_structure="ngForm"
        class="row">

    <!-- Nom -->
    <div class="form-group col-sm-12">
      <label class="form-label" for="nom_structure">Nom Structure</label>
      <input id="nom_structure" class="form-control"
             type="text"
             formControlName="nom_structure"
             placeholder="Nom Structure"
             [ngClass]="{ 'is-invalid': submitted && f.nom_structure.errors }" />
      @if (submitted && f.nom_structure.errors) {
        <div class="invalid-feedback">
          @if (f.nom_structure.errors.required) {
            <div>Ce champ est obligatoire</div>
          }
        </div>
      }
    </div>

    <!-- Adresse -->
    <div class="form-group col-sm-12">
      <label class="form-label" for="adresse_structure">Adresse Structure</label>
      <input id="adresse_structure" class="form-control"
             type="text"
             formControlName="adresse_structure"
             placeholder="Adresse Structure"
             [ngClass]="{ 'is-invalid': submitted && f.adresse_structure.errors }" />
      @if (submitted && f.adresse_structure.errors) {
        <div class="invalid-feedback">
          @if (f.adresse_structure.errors.required) {
            <div>Ce champ est obligatoire</div>
          }
        </div>
      }
    </div>

    <!-- Téléphone -->
    <div class="form-group col-sm-12">
      <label class="form-label" for="telephone_structure">Téléphone Structure</label>
      <input id="telephone_structure" class="form-control"
             type="text"
             formControlName="telephone_structure"
             placeholder="Téléphone Structure"
             [ngClass]="{ 'is-invalid': submitted && f.telephone_structure.errors }" />
      @if (submitted && f.telephone_structure.errors) {
        <div class="invalid-feedback">
          @if (f.telephone_structure.errors.required) {
            <div>Ce champ est obligatoire</div>
          }
        </div>
      }
    </div>

    <!-- Longitude -->
    <div class="form-group col-sm-12">
      <label class="form-label" for="longitude">Longitude</label>
      <input id="longitude" class="form-control"
             type="text"
             formControlName="longitude"
             placeholder="Longitude"
             [ngClass]="{ 'is-invalid': submitted && f.longitude.errors }" />
      @if (submitted && f.longitude.errors) {
        <div class="invalid-feedback">
          @if (f.longitude.errors.required) {
            <div>Ce champ est obligatoire</div>
          }
        </div>
      }
    </div>

    <!-- Latitude -->
    <div class="form-group col-sm-12">
      <label class="form-label" for="latitude">Latitude</label>
      <input id="latitude" class="form-control"
             type="text"
             formControlName="latitude"
             placeholder="Latitude"
             [ngClass]="{ 'is-invalid': submitted && f.latitude.errors }" />
      @if (submitted && f.latitude.errors) {
        <div class="invalid-feedback">
          @if (f.latitude.errors.required) {
            <div>Ce champ est obligatoire</div>
          }
        </div>
      }
    </div>

    <!-- Logo : identique au add mais avec logo actuel affiché -->
    <div class="form-group col-sm-12">
      <label class="form-label d-block">Logo de la structure</label>

      <div class="d-flex align-items-center gap-3">
        <!-- carte cliquable -->
        <div class="cam-card" (click)="logoInput.click()">
          <i class="bi bi-camera fs-2"></i>
        </div>

        <div class="d-flex flex-column gap-2">
          <button type="button" class="btn btn-outline-secondary btn-sm"
                  (click)="logoInput.click()">
            <i class="bi bi-upload me-1"></i> Choisir un nouveau logo
          </button>
          <button type="button" class="btn btn-outline-danger btn-sm"
                  (click)="clearLogo()"
                  [disabled]="!logoFile && !logoPreviewUrl">
            <i class="bi bi-x-circle me-1"></i> Retirer le logo
          </button>
          <div class="small text-muted">
            1 image max, {{maxLogoSizeMb}} Mo max (JPG/PNG/WEBP/GIF).
          </div>

          <div class="text-danger small" *ngIf="logoError">
            {{ logoError }}
          </div>
        </div>
      </div>

      <!-- input fichier caché -->
      <input type="file"
             class="d-none"
             accept="image/*"
             #logoInput
             (change)="onLogoSelected($event)">

      <!-- preview : nouveau logo ou logo actuel -->
      <div class="mt-3" *ngIf="logoPreviewUrl">
        <img [src]="logoPreviewUrl"
             class="card-img-top rounded border"
             alt="Logo structure" />
      </div>
    </div>

  </form>
</div>

<div class="modal-footer">
  <button type="button"
          class="btn btn-primary m-2"
          [disabled]="loading_edit_structure || loading_get_details_edit_structure_form"
          (click)="form_edit_structure.ngSubmit.emit()">
    {{ loading_edit_structure ? "En cours ..." : "Valider" }}
  </button>
  <button type="button" class="btn btn-outline-danger" (click)="activeModal.close()">Fermer</button>
</div>
