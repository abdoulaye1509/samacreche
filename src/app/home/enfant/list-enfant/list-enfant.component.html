<!-- entete (inchangé) -->
<div class="card p-3 position-sticky top-0 z-1">
  <div class="d-flex align-items-center justify-content-between mb-1">
    <div class="fs-4 fw-bold">
      Enfants {{ list.length==les_enfants.length ? list.length : (list.length + '/' + les_enfants.length) }}
    </div>
    <div class="d-flex">
      <button class="btn btn-primary" (click)="openModal_add_enfant()">
        <i class="bi bi-plus-square-dotted"></i> Enfant
      </button>
    </div>
  </div>

  <div class="d-flex gap-1 justify-content-end">
    <ng-select [multiple]="true" [closeOnSelect]="false" placeholder="Rechercher ici ..." notFoundText="Aucun résultat"
      class="no-limit" [(ngModel)]="filter.text" (search)="filter_change($event)" (change)="filter_change()"
      style="min-width: 400px;">
    </ng-select>
  </div>
</div>

<!-- état : chargement -->
<div *ngIf="loading_get_enfant" class="text-center text-secondary py-5">
  <div class="spinner-border" role="status"><span class="visually-hidden">Chargement...</span></div>
  <div class="mt-2">Chargement des enfants...</div>
</div>

<!-- état : vide -->
<div *ngIf="!loading_get_enfant && !list.length" class="text-center text-secondary py-5">
  <i class="bi bi-emoji-frown fs-1 d-block mb-2"></i>
  Aucun enfant trouvé.
  <p class="small text-muted mt-2">Clique sur “Enfant” pour en ajouter un.</p>
</div>

<!-- GRILLE DE CARTES -->

<div *ngIf="!loading_get_enfant && list.length" class="row g-3 mt-2">
  @for (one_enfant of list; track one_enfant) {
  <div class="col-12 col-sm-6 col-lg-4 col-xl-3" [routerLink]="['/home/enfant', one_enfant.id_enfant]">
    <div class="card child-card h-100" title="Voir les détails">
      <div class="card-body d-flex gap-3 align-items-center">
        <!-- Avatar / icône -->
        <div class="avatar">
          <img [src]="photoUrl(one_enfant)" (error)="onImgError($event)" alt="photo enfant" />
        </div>

        <!-- Infos -->
        <div class="flex-grow-1">
          <div class="fw-semibold text-truncate">
            {{ one_enfant.prenom_enfant }} {{ one_enfant.nom_enfant }}
          </div>
          <div class="d-flex gap-2 mt-1 small">
            <span class="badge bg-light text-dark" *ngIf="one_enfant.id_genre">{{ one_enfant.nom_genre }}</span>
          </div>
        </div>

        <!-- Actions (sans déclencher le clic carte) -->
        <div class="ms-auto d-flex gap-2 child-actions" (click)="$event.stopPropagation()">
          <button type="button" class="btn btn-outline-primary btn-sm" (click)="openModal_edit_enfant(one_enfant)"
            title="Modifier">
            <i class="bi bi-pencil-square"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  }
</div>