<!-- entete -->
<div class="card p-3 position-sticky top-0 z-1">
  <div class="d-flex align-items-center justify-content-between mb-2">
    <div class="fs-4 fw-bold">
      Parents {{ list.length==les_parents.length ? list.length : (list.length + '/' + les_parents.length) }}
    </div>

    <div class="d-flex align-items-center gap-2">
      <!-- Toggle vue -->
      <div class="btn-group" role="group" aria-label="Vue">
        <input class="btn-check" type="radio" id="vm-cards" name="vm" value="cards"
               [(ngModel)]="viewMode">
        <label class="btn btn-outline-secondary" for="vm-cards" title="Cartes">
          <i class="bi bi-grid-3x3-gap"></i>
        </label>

        <input class="btn-check" type="radio" id="vm-list" name="vm" value="list"
               [(ngModel)]="viewMode">
        <label class="btn btn-outline-secondary" for="vm-list" title="Liste">
          <i class="bi bi-list-ul"></i>
        </label>

        <input class="btn-check" type="radio" id="vm-table" name="vm" value="table"
               [(ngModel)]="viewMode">
        <label class="btn btn-outline-secondary" for="vm-table" title="Table">
          <i class="bi bi-table"></i>
        </label>
      </div>

      <button class="btn btn-primary" (click)="openModal_add_parent()">
        <i class="bi bi-plus-square-dotted"></i> Parent
      </button>
    </div>
  </div>

  <div class="d-flex gap-1 justify-content-end">
    <ng-select [multiple]="true" [closeOnSelect]="false" placeholder="Rechercher ici ..."
               notFoundText="Aucun résultat" class="no-limit"
               [(ngModel)]="filter.text" (search)="filter_change($event)" (change)="filter_change()"
               style="min-width: 400px;">
    </ng-select>
  </div>
</div>

<!-- état : chargement -->
<div *ngIf="loading_get_parent" class="text-center text-secondary py-5">
  <div class="spinner-border" role="status"><span class="visually-hidden">Chargement...</span></div>
  <div class="mt-2">Chargement des parents...</div>
</div>

<!-- état : vide -->
<div *ngIf="!loading_get_parent && !list.length" class="text-center text-secondary py-5">
  <i class="bi bi-emoji-frown fs-1 d-block mb-2"></i>
  Aucun parent trouvé.
  <p class="small text-muted mt-2">Clique sur “Parent” pour en ajouter un.</p>
</div>

<!-- ===== Vue CARTES ===== -->
<div *ngIf="!loading_get_parent && list.length && viewMode==='cards'" class="row g-3 mt-2">
  <div class="col-12 col-sm-6 col-lg-4 col-xl-3" *ngFor="let p of list; trackBy: trackParent">
    <div class="card parent-card clickable h-100"
         (click)="openModal_detail_parent(p)"
         title="Voir les détails">
      <div class="card-body d-flex align-items-center gap-3">
        <!-- Avatar -->
        <div class="avatar-circle"><span>{{ initials(p) }}</span></div>

        <!-- Infos -->
        <div class="flex-grow-1">
          <div class="fw-semibold text-truncate">{{ fullName(p) }}</div>
          <div class="text-muted small">#{{ p.id_parent }}</div>
          <div class="text-muted small mt-1">
            <span *ngIf="p?.adresse_parent"><i class="bi bi-geo-alt me-1"></i>{{ p.adresse_parent }}</span>
            <span *ngIf="p?.email_parent" class="ms-3"><i class="bi bi-envelope me-1"></i>{{ p.email_parent }}</span>
          </div>
        </div>

        <!-- Actions (ne pas déclencher le clic carte) -->
        <div class="ms-auto d-flex gap-2" (click)="$event.stopPropagation()">
          <button class="btn btn-outline-primary btn-sm" (click)="openModal_edit_parent(p)" title="Modifier">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn btn-outline-danger btn-sm" (click)="delete_parent(p)" title="Supprimer">
            <i class="bi bi-trash"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- ===== Vue LISTE COMPACTE ===== -->
<div *ngIf="!loading_get_parent && list.length && viewMode==='list'" class="list-group mt-2">
  <div class="list-group-item list-group-item-action py-3"
       *ngFor="let p of list; trackBy: trackParent"
       (click)="openModal_detail_parent(p)">
    <div class="d-flex align-items-center gap-3">
      <div class="avatar-circle avatar-sm">
        <span>{{ initials(p) }}</span>
      </div>

      <div class="flex-grow-1">
        <div class="d-flex align-items-center gap-2 flex-wrap">
          <span class="fw-semibold">{{ fullName(p) }}</span>
          <span class="badge text-bg-light">#{{ p.id_parent }}</span>
        </div>
        <div class="text-muted small mt-1">
          <span *ngIf="p?.adresse_parent"><i class="bi bi-geo-alt me-1"></i>{{ p.adresse_parent }}</span>
          <span *ngIf="p?.email_parent" class="ms-3"><i class="bi bi-envelope me-1"></i>{{ p.email_parent }}</span>
        </div>
      </div>

      <div class="d-flex gap-2" (click)="$event.stopPropagation()">
        <button class="btn btn-outline-primary btn-sm" (click)="openModal_edit_parent(p)" title="Modifier">
          <i class="bi bi-pencil-square"></i>
        </button>
        <button class="btn btn-outline-danger btn-sm" (click)="delete_parent(p)" title="Supprimer">
          <i class="bi bi-trash"></i>
        </button>
      </div>
    </div>
  </div>
</div>


<!-- ===== Vue TABLE ===== -->
<div *ngIf="!loading_get_parent && list.length && viewMode==='table'" class="table-responsive">
  <table class="table table-striped">
    <thead>
      <tr>
        <th>id_parent</th>
        <th>prenom_parent</th>
        <th>nom_parent</th>
        <th>adresse_parent</th>
        <th>actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of list; trackBy: trackParent">
        <td>{{ p.id_parent }}</td>
        <td>{{ p.prenom_parent }}</td>
        <td>{{ p.nom_parent }}</td>
        <td>{{ p.adresse_parent }}</td>
        <td>
          <i class="bi bi-pencil-square me-2" role="button" (click)="openModal_edit_parent(p)"></i>
          <i class="bi bi-trash" role="button" (click)="delete_parent(p)"></i>
        </td>
      </tr>
    </tbody>
  </table>
</div>
