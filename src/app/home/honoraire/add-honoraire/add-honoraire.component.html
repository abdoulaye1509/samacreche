<div class="modal-header">
  <h1 class="modal-title fs-6">
    <i class="bi bi-cash-stack me-2"></i> Nouvel honoraire
  </h1>
  <button type="button" class="btn-close" aria-label="Fermer" (click)="activeModal.close()"></button>
</div>

<div class="modal-body">
  <form [formGroup]="reactiveForm_add_honoraire"
        (ngSubmit)="onSubmit_add_honoraire()"
        #form_add_honoraire="ngForm"
        class="row g-3">

    <!-- Utilisateur -->
    <div class="col-12">
      <label class="form-label"><i class="bi bi-person-badge me-1"></i> Employé</label>
      <ng-select
        [items]="form_details?.les_utilisateurs || []"
        bindValue="id_utilisateur"
        placeholder="Choisir l’employé"
        formControlName="id_utilisateur"
        [ngClass]="{ 'is-invalid': submitted && f['id_utilisateur'].errors }">

        <!-- libellé dans le champ -->
        <ng-template ng-label-tmp let-item="item">
          {{ item?.prenom_utilisateur }} {{ item?.nom_utilisateur }}
        </ng-template>

        <!-- options -->
        <ng-template ng-option-tmp let-item="item">
          <div class="d-flex align-items-center gap-2">
            <i class="bi bi-person-circle text-primary"></i>
            <span class="fw-semibold">{{ item?.prenom_utilisateur }} {{ item?.nom_utilisateur }}</span>
          </div>
        </ng-template>
      </ng-select>
      <div class="invalid-feedback" *ngIf="submitted && f['id_utilisateur'].errors">Requis</div>
    </div>

    <!-- Date -->
    <div class="col-sm-6">
      <label class="form-label"><i class="bi bi-calendar-event me-1"></i> Date</label>
      <input type="date" class="form-control"
             formControlName="date_honoraire"
             [ngClass]="{ 'is-invalid': submitted && f.date_honoraire.errors }">
      <div class="invalid-feedback" *ngIf="submitted && f.date_honoraire.errors">Requis.</div>
    </div>

    <!-- Libellé -->
    <div class="col-sm-6">
      <label class="form-label"><i class="bi bi-card-text me-1"></i> Libellé</label>
      <input type="text" class="form-control"
             placeholder="Ex. Honoraire Décembre 2025"
             formControlName="libelle_honoraire"
             [ngClass]="{ 'is-invalid': submitted && f.libelle_honoraire.errors }">
      <div class="invalid-feedback" *ngIf="submitted && f.libelle_honoraire.errors">Requis.</div>
    </div>

   <!-- Montant net (formaté) -->
<div class="col-md-6">
  <label class="form-label"><i class="bi bi-cash-coin me-1"></i> Montant net à verser</label>
  <div class="input-group">
    <span class="input-group-text">CFA</span>
    <input
      id="montant_recu"
      class="form-control"
      type="text"
      inputmode="decimal"
      placeholder="Ex. : 25 000"
      [value]="api.formatMontant(f.montant_recu?.value, 0, ' ', ',')"
      (input)="api.formatMontantInput($event, reactiveForm_add_honoraire, 'montant_recu', {decimals: 0, sep: ' ', dec: ','})"
      [ngClass]="{ 'is-invalid': submitted && f.montant_recu?.errors }"
    />
  </div>
  <div class="invalid-feedback" *ngIf="submitted && f.montant_recu?.errors">Montant invalide (≥ 0).</div>
</div>

<!-- Statut honoraire -->
<div class="col-md-6">
  <label class="form-label"><i class="bi bi-flag me-1"></i> Statut</label>
  <ng-select
    [items]="form_details?.les_statut_honoraires || []"
    bindLabel="libelle_statut_honoraire"
    bindValue="id_statut_honoraire"
    placeholder="Choisir un statut"
    formControlName="id_statut_honoraire">
  </ng-select>
</div>


  </form>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-primary"
          [disabled]="loading_add_honoraire || loading_get_details_add_honoraire_form"
          (click)="form_add_honoraire.ngSubmit.emit()">
    {{ loading_add_honoraire ? "En cours..." : "Valider" }}
  </button>
  <button type="button" class="btn btn-outline-secondary" (click)="activeModal.close()">Fermer</button>
</div>
