<div class="modal-header" data-bs-theme="light">
  <h1 class="modal-title fs-6">
    <i class="bi bi-calendar2-plus me-2"></i>
    Nouveau planning
  </h1>
  <button type="button" class="btn-close" aria-label="Close" (click)="activeModal.close()"></button>
</div>

<div class="modal-body">
  <form [formGroup]="form" (ngSubmit)="onSubmit()" #f="ngForm" class="row g-3">

    <!-- Enfant (masqué si id_enfant injecté) -->
    <div class="col-12" *ngIf="!id_enfant">
      <label class="form-label">
        <i class="bi bi-person-badge me-1"></i> Enfant
      </label>
      <ng-select
        [items]="enfants"
        bindLabel="nom_complet"
        bindValue="id_enfant"
        placeholder="Choisir l’enfant"
        formControlName="id_enfant">
      </ng-select>
      <div class="invalid-feedback d-block" *ngIf="submitted && form.controls['id_enfant'].invalid">
        Enfant requis
      </div>
    </div>

    <div class="col-12 col-md-8">
      <label class="form-label">
        <i class="bi bi-type me-1"></i> Titre
      </label>
      <input class="form-control" type="text" formControlName="titre_planning_enfant" placeholder="Ex: Sieste, Pédiatre…">
      <div class="invalid-feedback d-block" *ngIf="submitted && form.controls['titre_planning_enfant'].invalid">
        Titre requis
      </div>
    </div>

    <div class="col-12 col-md-4">
      <label class="form-label">
        <i class="bi bi-palette me-1"></i> Couleur
      </label>
      <div class="d-flex align-items-center gap-2">
        <input class="form-control form-control-color flex-shrink-0 color-input"
               type="color" formControlName="couleur" title="Couleur de l’évènement">
        <input class="form-control" type="text" formControlName="couleur" placeholder="#4f46e5">
      </div>
      <div class="invalid-feedback d-block" *ngIf="submitted && form.controls['couleur'].invalid">
        Couleur au format hex (#rrggbb) requise
      </div>
    </div>

    <div class="col-12">
      <label class="form-label">
        <i class="bi bi-card-text me-1"></i> Description (facultatif)
      </label>
      <textarea class="form-control" rows="2" formControlName="description_planning_enfant"
                placeholder="Détails, lieu, consignes…"></textarea>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card p-3 shadow-xs">
        <div class="small text-muted mb-2">
          <i class="bi bi-play-circle me-1"></i> Début
        </div>
        <div class="row g-2">
          <div class="col-6">
            <input class="form-control" type="date" formControlName="date_debut">
          </div>
          <div class="col-6">
            <input class="form-control" type="time" formControlName="heure_debut">
          </div>
        </div>
      </div>
      <div class="invalid-feedback d-block" *ngIf="submitted && (form.controls['date_debut'].invalid || form.controls['heure_debut'].invalid)">
        Date et heure de début requises
      </div>
    </div>

    <div class="col-12 col-lg-6">
      <div class="card p-3 shadow-xs">
        <div class="small text-muted mb-2">
          <i class="bi bi-stop-circle me-1"></i> Fin
        </div>
        <div class="row g-2">
          <div class="col-6">
            <input class="form-control" type="date" formControlName="date_fin">
          </div>
          <div class="col-6">
            <input class="form-control" type="time" formControlName="heure_fin">
          </div>
        </div>
      </div>
      <div class="invalid-feedback d-block" *ngIf="submitted && (form.controls['date_fin'].invalid || form.controls['heure_fin'].invalid)">
        Date et heure de fin requises
      </div>
      <div class="invalid-feedback d-block" *ngIf="submitted && dateRangeInvalid">
        La fin doit être postérieure au début.
      </div>
    </div>

  </form>
</div>

<div class="modal-footer">
  <button type="button" class="btn btn-outline-danger" (click)="activeModal.close()" [disabled]="loading">
    Fermer
  </button>
  <button type="button" class="btn btn-primary" [disabled]="loading" (click)="f.ngSubmit.emit()">
    <i class="bi bi-check2-circle me-1"></i>
    {{ loading ? 'Enregistrement…' : 'Valider' }}
  </button>
</div>
